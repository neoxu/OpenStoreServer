var MongoClient = require('mongodb').MongoClient;
var format = require('util').format;
var urlNiceMarket = format('');
var usersCollection = 'users';

var userName = {};

exports.getUserName = function(account) {
	if (account && userName[account]) {
		return userName[account];
	}
	else 
	  	return '';
}

exports.addUserName = function(account, name) {
	userName[account] = name;
}

exports.loadUserName = function() {
	MongoClient.connect(urlNiceMarket, function(err, db) {
		if (!err) {			
			if (db != null) {
				var collection = db.collection(usersCollection);
				if (collection != null) {	
					var fields = {_id: 0};
					var myCursor = collection.find({}, fields); 
					
					myCursor.toArray(function(err, docs) {
						if (!err) {							
							for (var i in docs) {
								userName[docs[i].account] = docs[i].name;
							}
						}
					});    
				} else
					console.log(collectionName + ' not found');
			} else
				console.log(dbUrl + ' not found');
		} else
			console.log(dbUrl + ' connect fail ' + err);		
	});
}
